{% extends "../layouts/app.html" %}

{% block title %} Gaji {% endblock title %}

{% block nav-menu-open-gaji %} menu-open {% endblock %}

{% block nav-active-gaji %} active {% endblock %}


{% block content-header-page %}
<li class="breadcrumb-item"><a href="{% url 'kepegawaian:indexBulanTahun' %}">Tanggal Penggajian Pegawai</a></li>
<li class="breadcrumb-item active"><a href="{% url 'kepegawaian:detailGaji' gajis.0.bulantahun_id %}">{{gajis.0.bulantahun.get_bulan_display}} {{gajis.0.bulantahun.tahun}}</a></li>
<li class="breadcrumb-item active">{{gajis.0.nupy.nupy}}</li>
{% endblock content-header-page %}

{% block print %}
<form action="{% url 'kepegawaian:printDetailGajiPegawai'%}" method="POST" target="_blank">
  {% csrf_token %}
  <input type="hidden" name="id_bulan_tahun" value="{{gajis.0.bulantahun_id}}">
  <input type="hidden" name="nupy" value="{{gajis.0.nupy.nupy}}">               
  <button  title="Print Gaji Pegawai" class="btn btn-sm hover"><i class="fas fa-print" style="color: rgb(0, 0, 0);"></i>Print</button>
</form>
{% endblock print %}


{% block content %}
<style> i.ihover{color: rgb(164, 44, 44);}i.ihover:hover{color: rgb(228, 79, 79);} i.dhover{color: rgb(22, 100, 62);} i.dhover:hover{color: rgb(56, 167, 102);}</style> 
<div class="row">
    <!-- Left col -->
<section class="col-lg-12 connectedSortable">
      <!-- Custom tabs (Charts with tabs)-->
    <!-- Detail Pegawai -->
    <div class="card card-outline card-success">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-wallet mr-1"></i>
                  Detail Gaji Pegawai NUPY : <strong> {{gajis.0.nupy.nupy}} </strong>
                </h3>
             </div><!-- /.card-header -->
                <div class="card-body">
                    <div class="tab-content p-0">
                        <!-- Morris chart - Sales -->
                    <div class="tab-pane active">

                        <div class="app-table">
                            <table id="table" class="table table-striped table-hover table-sm table-responsive-md">
                              <thead>
                                <tr>
                                  <th scope="col">Nama Pegawai</th>
                                  <th scope="col">NUPY</th>
                                  <th scope="col">Jabatan
                                    <figcaption class="blockquote-footer">
                                      <small  class="text-muted">Gaji Pokok</small>
                                    </figcaption>
                                  </th>
                                  <th scope="col">Kuantitas</th>
                                  <th scope="col">Gaji Jabatan
                                    <figcaption class="blockquote-footer">
                                      <small  class="text-muted">Gaji Pokok x Kuantitas</small>
                                    </figcaption></th>                                  
                                  <th scope="col">Ekskul</th>
                                  <th scope="col">Kinerja</th>
                                  <th scope="col">Tunjangan</th>
                                  <th scope="col">Total</th>
                                  <th scope="col">Ket.</th>
                                </tr>
                              </thead>
                              <tbody>
                              {% load mathfilters %}
                              {% load humanize %}
    
                              {% regroup gajis by nupy as grouped %}                    
                              {% for group in grouped%}
                              {% for gaji in group.list %}                        
                                <tr>
                                  {% ifchanged %}<td rowspan="{{ group.list|length }}">{{gaji.nupy.nama_pegawai}}</td>{% endifchanged %}
                                  {% ifchanged %}<td rowspan="{{ group.list|length }}">{{gaji.nupy.nupy}}</td>{% endifchanged %}
                                  <td>{{gaji.jabatan.nama_jabatan}}
                                    <figcaption class="blockquote-footer">
                                      <small class="text-muted">{{gaji.jabatan.gaji_pokok|intcomma}}</small>
                                    </figcaption>
                                  </td>
                                  <td>{{gaji.kuantitas}}</td>
                                  <td id="amtlbl" style="background-color: rgb(206, 195, 71);  font-weight: bold;">{{gaji.jabatan.gaji_pokok|mul:gaji.kuantitas }}</td>
                                  {% ifchanged %}<td id="amtlbl" rowspan="{{ group.list|length }}" style="background-color: rgb(206, 71, 71);  font-weight: bold;">{{gaji.ekskul}}</td>{% endifchanged %}
                                  {% ifchanged %}<td id="amtlbl" rowspan="{{ group.list|length }}" style="background-color: rgb(206, 71, 71);  font-weight: bold;">{{gaji.kinerja}}</td>{% endifchanged %}
                                  {% ifchanged %}<td id="amtlbl" rowspan="{{ group.list|length }}" style="background-color: rgb(206, 71, 71);  font-weight: bold;">{{gaji.tunjangan}}</td>{% endifchanged %}
                                  {% ifchanged %}<td id="totlbl" style="background-color: rgb(71, 206, 125);  font-weight: bold;"> </td>{% endifchanged %}
                                  {% ifchanged %}<td rowspan="{{ group.list|length }}">{{gaji.ket_gaji}}</td>{% endifchanged %}
                                </tr>
                              {% endfor %}
                              {% endfor %}
                              </tbody>
                            </table>
                          </div>
                    </div> 
                    </div>
                </div><!-- /.card-body -->
      <!-- Detail Jabatan -->
</section>
    <!-- /.Left col -->
  </div>
  
{% endblock content %}

{% block script %}
    <script>
      $(function() {
        var grandtotal = 0;
        $("[id*=amtlbl]").each(function (){
          grandtotal = grandtotal + parseFloat($(this).html());
        });
        $("[id*=totlbl]").html(grandtotal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));
      });
      
    </script>
{% endblock script %}